---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { TAGS } from "../../data/projects";
import Badge from "../../components/UI/Badge.astro";
import { Icon } from "astro-icon/components";

export async function getStaticPaths() {
    const projects = await getCollection("projects");
    return projects.map((project) => ({
        params: { slug: project.slug },
        props: { project },
    }));
}

const { project } = Astro.props;
const { Content } = await project.render();

// Map string tags from frontmatter back to full TAGS objects
const richTags = project.data.tags
    .map((tagKey) => TAGS[tagKey])
    .filter(Boolean);
---

<Layout>
    <main class="pt-24 pb-20 px-4 min-h-screen">
        <div class="max-w-4xl mx-auto">
            <!-- Back Button -->
            <a
                href={import.meta.env.BASE_URL.replace(/\/$/, "") +
                    "/#projects"}
                class="inline-flex items-center gap-2 text-gray-400 hover:text-white transition-colors mb-8 group"
            >
                <Icon
                    name="lucide:arrow-left"
                    class="size-5 transition-transform group-hover:-translate-x-1"
                />
                Back to Projects
            </a>

            <!-- Project Header -->
            <div class="space-y-6 mb-12">
                <h1 class="text-4xl md:text-5xl font-bold text-white">
                    {project.data.title}
                </h1>

                <!-- Tags -->
                <div class="flex flex-wrap gap-2">
                    {
                        richTags.map((tag) => (
                            <Badge
                                class:list={[
                                    "flex items-center gap-x-2 text-sm py-1.5 px-3 border-white/5",
                                    tag.class,
                                ]}
                            >
                                <Icon name={tag.icon} class="size-4" />
                                {tag.name}
                            </Badge>
                        ))
                    }
                </div>
            </div>

            <!-- Project Image -->
            <div
                class="rounded-3xl overflow-hidden border border-white/10 shadow-2xl mb-12 bg-gray-900"
            >
                <img
                    src={import.meta.env.BASE_URL.replace(/\/$/, "") +
                        project.data.image}
                    alt={project.data.title}
                    class="w-full h-auto"
                    transition:name={`project-image-${project.slug}`}
                />
            </div>

            <!-- Content -->
            <div class="grid md:grid-cols-3 gap-12">
                <div
                    class="md:col-span-2 space-y-6 prose prose-invert prose-lg max-w-none"
                >
                    <h2 class="text-2xl font-bold text-white mb-4">About</h2>
                    <Content />
                </div>

                <!-- Sidebar / Links -->
                <div class="space-y-6">
                    <div class="glass-card p-6 rounded-2xl space-y-4">
                        <h3 class="text-xl font-bold text-white">Links</h3>
                        {
                            project.data.github && (
                                <a
                                    href={project.data.github}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="flex items-center gap-3 text-gray-300 hover:text-white transition-colors"
                                >
                                    <Icon name="lucide:github" class="size-5" />
                                    <span>Source Code</span>
                                </a>
                            )
                        }
                        {
                            project.data.link && (
                                <a
                                    href={project.data.link}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="flex items-center gap-3 text-gray-300 hover:text-white transition-colors"
                                >
                                    <Icon
                                        name="lucide:external-link"
                                        class="size-5"
                                    />
                                    <span>
                                        {project.data.linkText || "Live Demo"}
                                    </span>
                                </a>
                            )
                        }
                        {
                            project.data.paper && (
                                <a
                                    href={project.data.paper}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="flex items-center gap-3 text-gray-300 hover:text-white transition-colors"
                                >
                                    <Icon
                                        name="lucide:file-text"
                                        class="size-5"
                                    />
                                    <span>Paper</span>
                                </a>
                            )
                        }
                    </div>
                </div>
            </div>
        </div>
    </main>
</Layout>
