---
import CardProject from "./CardProject.astro";
import Section from "../UI/Section.astro";
import { getCollection } from "astro:content";
import { TAGS } from "../../data/projects";

const projects = (await getCollection("projects")).sort(
    (a, b) => a.data.order - b.data.order,
);
---

<Section id="projects" title="Selected Projects" titleClassName="mb-12">
    <!-- Filter Buttons -->
    <div class="flex flex-wrap justify-center gap-4 mb-16" data-aos="fade-up">
        <button
            class="filter-btn active px-6 py-2 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 transition-all duration-300 text-sm font-medium"
            data-filter="all">All</button
        >
        <button
            class="filter-btn px-6 py-2 rounded-full border border-white/10 bg-gray-900/50 hover:bg-white/10 transition-all duration-300 text-sm font-medium"
            data-filter="Robotics">Robotics</button
        >
        <button
            class="filter-btn px-6 py-2 rounded-full border border-white/10 bg-gray-900/50 hover:bg-white/10 transition-all duration-300 text-sm font-medium"
            data-filter="AI">AI & ML</button
        >
        <button
            class="filter-btn px-6 py-2 rounded-full border border-white/10 bg-gray-900/50 hover:bg-white/10 transition-all duration-300 text-sm font-medium"
            data-filter="Collective">Collective Systems</button
        >
    </div>

    <div class="flex flex-col gap-y-32" id="projects-container">
        {
            projects.map((project) => {
                const richTags = project.data.tags.map((t) => TAGS[t]);
                return (
                    <div
                        class="project-item transition-all duration-500"
                        data-category={richTags.map((t) => t.name).join(",")}
                    >
                        <CardProject
                            {...project.data}
                            tags={richTags}
                            slug={project.slug}
                        />
                    </div>
                );
            })
        }
    </div>
</Section>

<style>
    .filter-btn.active {
        background-color: rgba(255, 222, 33, 0.3);
        border-color: rgba(255, 222, 33, 0.5);
        color: white;
        box-shadow: 0 0 15px rgba(255, 222, 33, 0.2);
    }
</style>

<script>
    const buttons = document.querySelectorAll(".filter-btn");
    const projects = document.querySelectorAll(".project-item");

    buttons.forEach((btn) => {
        btn.addEventListener("click", () => {
            // Remove active class from all buttons
            buttons.forEach((b) => b.classList.remove("active"));
            buttons.forEach((b) => b.classList.add("bg-gray-900/50"));

            // Add active class to clicked button
            btn.classList.add("active");
            btn.classList.remove("bg-gray-900/50");

            const filterValue = btn.getAttribute("data-filter") || "all";

            projects.forEach((project) => {
                const el = project as HTMLElement;
                const categories = el.getAttribute("data-category");

                if (
                    filterValue === "all" ||
                    (categories && categories.includes(filterValue))
                ) {
                    el.style.display = "block";
                    // Use requestAnimationFrame to ensure display:block applies before opacity transition
                    requestAnimationFrame(() => {
                        el.style.opacity = "1";
                        el.style.transform = "translateY(0)";
                    });
                } else {
                    el.style.opacity = "0";
                    el.style.transform = "translateY(20px)";
                    setTimeout(() => {
                        el.style.display = "none";
                    }, 300);
                }
            });
        });
    });
</script>
